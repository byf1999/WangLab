# ChIP_seq

## Overview

The `ChIP_seq` module is part of the WangLab suite of tools and contain 3 commands which consists a whole analysis workflow of ChIP-seq.

## Detailed Description

The `ChIP_seq` module can be called using:

```bash
wanglab {subcommand} ...
```

- [cutadapt](#cutadapt)

The `cutadapt` subcommand takes in the directory of raw data (i.e. fq.gz). Similar to `cutadapt` in `TIS` module, users need to set data type as `ChIP-seq` by `-t chip-seq`.

Unlike `TIS` module, we only use `cutadapt` to trim 3' adaptors, and maintain those without adaptor sequences. This program is fulfilled by running [cutadapt](https://cutadapt.readthedocs.io/en/stable/) with the following parameters: `-O 5 -e 0.1 -m 8`.

- [bowtie](#bowtie)

The `bowtie` subcommand takes in the directory of trimmed files and a reference genome file, and map reads to the genome. Similarly, users need to set `-t` as `chip-seq`. After mapping, the program will use [`samtools`](https://anaconda.org/bioconda/samtools) to convert `sam` files to `bam` files, sort and generate index for visualization using tools like IGV.

This program is fulfilled by running [bowtie](https://bowtie-bio.sourceforge.net/index.shtml) with the following parameters: `-M 1 -q --sam`.

- [macs](#macs)

The `macs` subcommand takes in a treatment bam and a control bam and run [macs3 callpeak](https://github.com/macs3-project/MACS). By default, the parameters will be set as `-f BAM -q 0.01 -B -m 1 50 --keep-dup 1`. Although some parameters could be [modified](#macs), it is **recommended** to directly run `macs3 callpeak`  command. 



## Command Line Options

### cutadapt

- `-d` or `--dir`: Directory of fq.gz files. If raw data are not end with fq.gz (e.g. fastq.gz), users need to modify [cutadapt.py](../WangLab/TIS/cutadapt.py) line 43. REQUIRED.
- `-t` or `--type`: Data type, `Tn-seq`or `ChIP-seq`. REQUIRED.
- `-p` or `--plasmid`: Transposon plasmid name, `pSC189` or `Tn5`. REQUIRED only if `-t` is set as `Tn-seq`.

### bowtie

- `-d` or `--dir`: Directory of trimmed files. This command will automatically recognize files generated by `cutadapt`. REQUIRED.
- `-r` or `--ref`: Reference file path. Multiple references could exist in a single file. REQUIRED.
- `-t` or `--type`: Data type, `Tn-seq` or `ChIP-seq`. REQUIRED.
- `-@` or `--core`: Number of alignment threads to launch. Default if 1.

### macs

- `-t` or `--treat`: Treatment bam file. REQUIRED.
- `-c` or `--control`: Control file. REQUIRED.
- `-l` or `--length`: Effective genome length. If set as `eib202` or `A_veronii`, the program will transfer into their genome length. REQUIRED.
- `--keep-dup`: It controls the behavior towards duplicate tags at the exact same location -- the same coordination and the same strand. The 'auto' option makes MACS calculate the maximum tags at the exact same location based on binomial distribution using 1e-5 as pvalue cutoff; and the 'all' option keeps every tags. If an integer is   given, at most this number of tags will be kept at the same location. Note, if you've used samtools or picard to flag reads as 'PCR/Optical duplicate' in bit 1024, MACS3 will still read them although the reads may be decided by MACS3 as duplicate later. If you plan to rely on samtools/picard/any other tool to filter duplicates, please remove those duplicate reads and save a new alignment file then ask MACS3 to keep all by '--keep-dup all'. The default is to keep one tag at        the same location. Default: 1.

